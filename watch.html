<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch Video</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #000;
    margin: 0;
    color: #fff;
    text-align: center;
  }
  video {
    width: 100%;
    max-width: 900px;
    height: auto;
    margin-top: 20px;
  }
  #qualitySelect {
    margin-top: 15px;
    padding: 5px 10px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h1 id="videoTitle">Loading...</h1>
<video id="mainVideo" controls autoplay></video>
<br>
<select id="qualitySelect" style="display:none;"></select>

<script>
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

const videoId = getQueryParam('id');
const videoElement = document.getElementById('mainVideo');
const qualitySelect = document.getElementById('qualitySelect');

fetch('videos.json?v=' + Date.now())
  .then(response => response.json())
  .then(videos => {
    const videoData = videos[videoId];
    if (videoData) {
      document.getElementById('videoTitle').textContent = videoData.title;

      // Always add 1080p
      const options = [];
      if (videoData.fullUrl) {
        options.push({label: '1080p', url: videoData.fullUrl});
      }
      // Add 4K only if available
      if (videoData.fullUrl4k) {
        options.push({label: '4K', url: videoData.fullUrl4k});
      }

      // Load first available quality
      if (options.length > 0) {
        videoElement.src = options[0].url;
      }

      // If more than one quality, show dropdown
      if (options.length > 1) {
        qualitySelect.style.display = 'inline-block';
        options.forEach(opt => {
          const optionEl = document.createElement('option');
          optionEl.value = opt.url;
          optionEl.textContent = opt.label;
          qualitySelect.appendChild(optionEl);
        });

        qualitySelect.addEventListener('change', () => {
          videoElement.src = qualitySelect.value;
          videoElement.play();
        });
      }
    } else {
      document.getElementById('videoTitle').textContent = 'Video not found';
    }
  });
</script>

</body>
</html>
